## 概述

http 请求节点支持请求某些 http 接口，然后获取数据进行后续的操作

## 配置面板

### 基本信息

![image.png](/img/服务编排/http-01.png)

- **节点标题：**通过设置节点标题改变当前循环节点的名称，便于对节点的说明和管理。
- **入参来源：**设置来自前端的入参来源，默认是 `input`；
- **节点出参：**该节点出参的变量名，默认是 `output`；
- **请求地址：**请求的接口地址；
- **请求方法：**配置请求接口的方法；
- **重试次数：**接口请求失败后的重试次数

### 提交参数

![image.png](/img/服务编排/http-02.png)

- **Query 转换：**请求接口的参数的映射配置，可以通过 `f(x)` 获取上下文变量和系统变量。
- **Header 转换：**请求的请求头的映射配置，可以通过 `f(x)` 获取上下文变量和系统变量。

*追加字段*模式指的是，配置的变量映射会和默认的值进行合并；*覆盖所有字段*模式指的是，配置的变量映射会直接覆盖默认已有的值

### 返回结果

![image.png](/img/服务编排/http-03.png)

爱速搭接口所需的返回格式是：

```json
{
  "status": 0,
  "msg": "",
  "data": {
    ...其他字段
  }
}
```

- **status**: 状态码，返回 `0` 表示当前接口正确返回，否则按错误请求处理
- **msg**: 返回接口处理信息，主要用于表单提交或请求失败时的 `toast` 显示
- **data**: 返回的具体数据

同时也兼容以下几种放回格式

1. errorCode 作为 status、errorMessage 作为 msg
2. errno 作为 status、errmsg/errstr 作为 msg
3. error 作为 status、errmsg 作为 msg
4. error.code 作为 status、error.message 作为 msg
5. message 作为 msg

如果返回的内容不是这些格式，或者返回内容不是 JSON，则需要对返回结果进行转换。

- **文件下载：**开启文件下载可以处理下载文件的场景，否则下载后文件会乱码
- **返回结果转换：**可以对返回接口的数据进行转换
- **返回结果适配：**可以编写自定义 js 代码，进行结果调整适配

转换方法有以下几种：

1. 复制到，用于将所有数据复制到某个字段下
2. 取字段，用于将数据复制到返回结果的某个字段下
3. 删除字段
4. JSON 路径查询
5. 模板，使用 Handlebars 模板对结果进行转换
6. 字符串拆分数组，比如返回结果是 `"1,2,3"`，可以将其转成 `[1,2,3]`
7. 正则，抽取第一个组，通常用于 xml 中直接获取某个数据

### 认证鉴权

![image.png](/img/服务编排/http-04.png)

目前支持四种鉴权方式：

- HTTP 帐号密码。
- JWT，将会对所有 query 及 header 及进行签名，写入 header 的 Authorization 字段中。
- 百度云，将会对提交数据及 header 都做签名，写入 header 的 Authorization 字段中
- 第三方签名，将用户信息发送给另外一个接口，返回 token 字段，此 token 写入 header 的 Authorization 字段中。这个 token 将被缓存 15 分钟左右。
